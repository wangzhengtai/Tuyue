# Tuyue

图悦——图片浏览App

<div align=center>
  <img width="180" height="320" src="https://github.com/wangzhengtai/Tuyue/blob/master/images/S90308-214737.jpg">
  <img width="180" height="320" src="https://github.com/wangzhengtai/Tuyue/blob/master/images/S90308-214748.jpg">
  <img width="180" height="320" src="https://github.com/wangzhengtai/Tuyue/blob/master/images/S90308-214753.jpg">
  <img width="180" height="320" src="https://github.com/wangzhengtai/Tuyue/blob/master/images/S90308-214758.jpg">
</div>

## 项目简介

采用OkHttp网络请求库来进行图片网络请求，同时利用其自带的网络请求缓存机制，实现其返回流缓存，再同时进行采样率压缩，获得其压缩后的bitmap后，最后利用LruCache实现其内存缓存，来达到想要的效果！

## 总结

写这个项目之前，是为了更好的理解从网络请求到图片加载，最后再完美显示的过程！平常加载图片总是用着开源库，一行代码就搞定！虽然用着很简单，效果也很好，但终究有着很多不明白，所以就有了这次尝试！

但最后的结果，就是这次尝试失败了，匆匆结尾，很多问题未解决！主要原因还是自身的水平不够，很多问题没有很好的解决，最初为了省事，直接用的MVC模式写的，代码结构不够明确，其中的功能也未详细拆分，导致代码混乱，最后自己都不想写了！现在想来，代码架构真的很重要啊！！！还有就是图片的api请求来的图片都是电脑壁纸那样的宽屏图，不是我想要的手机壁纸那样的长屏图，弄得自己继续写下去得欲望又低了！

不过，还是要总结一番！

虽然最后如上面介绍的一番，利用网络请求缓存和内存缓存，外加采样率压缩，最后是成功实现了图片的加载和缓存，但是其效果并不是很好，在屏幕快速滑动在滑回来时，其仍然需要稍微闪烁一下，才显示出图片！而有的图片软件，即使是使劲的不断往下翻，再往上滑回去的时候总是秒加载，不过它缓存占用的内存也是很多！

其实自己不应该用OkHttp的缓存机制的，应该自己动手实现文件缓存，最好自己开线程池，这样就能将一切都处于自己的控制之下！

#### 记下几个需要重点考虑的点

* 生命周期的问题

  在activity的停止或者销毁后，其中的请求应该中止！Glide是向其中添加一个隐藏的Fragment来实现的，不太懂~~~

* ImageView尺寸的测量

  为了实现采样率压缩，必须需要要得到图片View的大小，应注意合适的时机！或许可以在请求开始load之前获取大小，此时的大小应该是准备好了的，如果没有应获取大小再回调！
  
* 请求的取消机制

  在图片滑动的过程中，应该停止网络请求，等到滑动结束的时候，再开始请求！为此必须要有一个取消机制！如果是自己实现线程池的话，或许可以尝试通过控制线程池来达到要求！

* Options.inBitmap内存复用

  Glide还实现了bitmap对象的复用，通过Options.inBitmap这个字段！Android 4.4开始只要旧bitmap的尺寸大于等于新的bitmap就可以复用了。需要1、不用的bitmap用软引用保存起来，以备复用；2、使用前面保存的bitmap来创建新的bitmap。还是需要多研究啊！

* 缓存的问题

  文件缓存（应该缓存大图的），内存缓存，一直在想采样率要不要缓存起来？
